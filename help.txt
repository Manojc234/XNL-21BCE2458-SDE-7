import { html, LitElement, css } from "lit";
import { createContext, contexts } from "@scdevkit/data";

const graphQLClientContext = createContext(contexts.GRAPHQL_CLIENT);

export class Grid extends LitElement {
  static styles = css`
    :host {
      display: flex;
      justify-content: center;
      padding: 1rem;
    }
    sc-data-grid {
      width: 100%;
      max-width: 1000px;
    }
  `;

  static properties = {
    rows: { type: Array },
  };

  constructor() {
    super();
    this.rows = [];
  }

  _graphQLClientContextConsumer = graphQLClientContext.createConsumer(this);

  connectedCallback() {
    super.connectedCallback();
    this.fetchData();
  }

  async fetchData() {
    const graphQLClient = this._graphQLClientContextConsumer.value;
    console.log("GraphQL Client:",graphQLClient);
    let response;

    try {
      const response = await graphQLClient.query( `{
        show {
          name
          email
          dob
          gender
          pno
        }
      }
    `);
      const result=await response.json();
      console.log(result);
      const rowsArray=result.data;
      console.log(rowsArray);
      this.rows=rowsArray.show;
      
    } catch (err) {
      console.error("GraphQL query failed:", err);
    }
  }

  render() {
    const conf=[
          { property: "name", header: "Name" },
          { property: "email", header: "Email" },
          { property: "dob", header: "Date of Birth" },
          { property: "gender", header: "Gender" },
          { property: "pno", header: "Phone Number" },
        
      ]
    return html`
      <sc-table
      .conf=${conf} .data=${this.rows}
       page-size="" sort=""
      >
      </sc-table>
    `;
  }
}

